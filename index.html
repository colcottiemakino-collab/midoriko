<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>数当てバトル</title>
<style>
body {
    font-family: Arial, sans-serif;
    background-color: #eaf2e0;
    color: #1f3b1f;
    margin: 0;
    padding: 20px;
}
h1 {
    color: #2f5e2f;
    text-align: center;
}
button {
    background-color: #4c8c4a;
    color: white;
    padding: 10px;
    border: none;
    cursor: pointer;
    margin: 5px;
}
button:disabled {
    background-color: #a9c7a9;
    cursor: not-allowed;
}
input[type="number"] {
    padding: 5px;
    margin: 5px;
    width: 80px;
}
pre {
    background-color: #f5fff0;
    border: 1px solid #aacaaa;
    padding: 10px;
    white-space: pre-wrap;
}
</style>
</head>
<body>
<h1>数当てバトル</h1>
<div id="status"></div>
<div id="question-buttons"></div>
<div id="number-input"></div>
<pre id="log"></pre>

<script>
const totalNumbers = 100;
let playerNumbers = Array.from({length: totalNumbers}, (_, i) => i + 1);
let aiNumbers = Array.from({length: totalNumbers}, (_, i) => i + 1);

let scorePlayer = 0;
let scoreAI = 0;
let winTarget = 5;

let round = 1;
let firstPlayer = "player";
let questionUsed = false;
let aiChosen = null;

function initGame() {
    log(`--- ゲーム開始 ---\n`);
    updateStatus();
    setupQuestionButtons();
    nextRound();
}

function setupQuestionButtons() {
    const qDiv = document.getElementById("question-buttons");
    qDiv.innerHTML = "";
    const questions = [
        "1: ワン", "2: ツー", "3: スリー", "4: フォー",
        "5: ファイブ", "6: シックス", "7: セブン", "8: エイト", "9: ナイン"
    ];
    questions.forEach((q, idx) => {
        const btn = document.createElement("button");
        btn.textContent = q;
        btn.onclick = () => useQuestion(idx + 1);
        qDiv.appendChild(btn);
    });
}

function updateStatus() {
    document.getElementById("status").innerHTML = 
        `ラウンド ${round}　スコア: あなた ${scorePlayer} - AI ${scoreAI}<br>` +
        `あなたの残り(${playerNumbers.length}個)：${playerNumbers.join(", ")}`;
}

function nextRound() {
    questionUsed = false;
    aiChosen = null;
    if (firstPlayer === "ai") {
        aiChosen = aiChooseNumber();
        aiNumbers = aiNumbers.filter(n => n !== aiChosen);
        log(`AIが数字を決めました（非公開）`);
        showNumberInput();
    } else {
        showNumberInput();
    }
}

function showNumberInput() {
    const nDiv = document.getElementById("number-input");
    nDiv.innerHTML = "";
    const input = document.createElement("input");
    input.type = "number";
    input.min = 1;
    input.max = 100;
    input.id = "player-number";
    const btn = document.createElement("button");
    btn.textContent = "出す";
    btn.onclick = submitNumber;
    nDiv.appendChild(input);
    nDiv.appendChild(btn);
}

function useQuestion(qNum) {
    if (questionUsed) {
        alert("このラウンドでは質問は1回までです");
        return;
    }
    questionUsed = true;
    const answer = aiAnswer(qNum);
    log(`質問${qNum} の回答: ${answer}`);
}

function submitNumber() {
    const val = parseInt(document.getElementById("player-number").value);
    if (isNaN(val) || !playerNumbers.includes(val)) {
        alert("未使用の1〜100の数字を入力してください");
        return;
    }
    if (firstPlayer === "player") {
        aiChosen = aiChooseNumber();
        aiNumbers = aiNumbers.filter(n => n !== aiChosen);
    }
    playerNumbers = playerNumbers.filter(n => n !== val);
    log(`出した数字：あなた ${val} / AI ${aiChosen}`);
    judge(val, aiChosen);
}

function aiChooseNumber() {
    return aiNumbers[Math.floor(Math.random() * aiNumbers.length)];
}

function aiAnswer(qNum) {
    switch(qNum) {
        case 1: return "ワン判定";
        default: return "未実装";
    }
}

function judge(p, a) {
    let winner;
    // ワン特例
    if ((p % 10) === (a % 10)) {
        winner = (p < a) ? "player" : "ai";
    } else if ((p % 2) !== (a % 2)) {
        winner = (p % 2 === 1) ? "player" : "ai";
    } else if (p % 3 === 0 && a % 3 === 0) {
        winner = (p < a) ? "player" : "ai";
    } else {
        winner = (p > a) ? "player" : "ai";
    }

    if (winner === "player") scorePlayer++;
    else scoreAI++;

    log(`${winner === "player" ? "あなた" : "AI"}の勝ち！`);
    round++;
    updateStatus();
}

function log(msg) {
    document.getElementById("log").textContent += msg + "\n";
}

initGame();
</script>
</body>
</html>
