<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hundred PvP v3.3.2</title>
<style>
:root{
  --bg:#0e1a12; --bg2:#122216; --panel:#152a1b; --accent:#35c46e; --accent-2:#2aa55b;
  --text:#e7ffe7; --muted:#b9d8c0; --warn:#ffd37a; --bad:#ff8a8a; --good:#8affb9;
  --grid-used:#2a3a2f; --btn:#173d26; --btn-hover:#1f5333; --border:#2f6848;
}
*{box-sizing:border-box}
html,body{margin:0;overflow-x:hidden;background:linear-gradient(180deg,var(--bg),var(--bg2));color:var(--text);
  font-family:ui-sans-serif,system-ui,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;}
header{padding:18px 20px;border-bottom:1px solid var(--border);display:flex;align-items:baseline;gap:12px}
h1{margin:0;font-size:20px;letter-spacing:.08em;color:var(--accent)}
main{display:grid;grid-template-columns:420px 1fr 360px;gap:16px;padding:16px}
@media(max-width:1200px){main{grid-template-columns:1fr}}

.card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:14px;
  box-shadow:0 10px 20px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.04);}
.card h2{margin:0 0 10px;font-size:16px;color:var(--accent)}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
select,button,input{background:var(--btn);color:var(--text);border:1px solid var(--border);
  border-radius:10px;padding:8px 10px;font-size:14px}
button:hover{background:var(--btn-hover)}button:disabled{opacity:.45;cursor:not-allowed}
.accent{background:var(--accent-2);border-color:transparent;color:#04210f;font-weight:700}
.muted{color:var(--muted);font-size:12px}

.grid{display:grid;grid-template-columns:repeat(10,minmax(0,1fr));gap:6px}
.cell{padding:8px 0;text-align:center;border-radius:10px;border:1px solid var(--border);
  user-select:none;cursor:pointer;background:#13301e;transition:transform .05s ease,background .15s ease;
  font-variant-numeric:tabular-nums;font-size:clamp(11px,2.8vw,16px)}
.cell:hover{transform:translateY(-1px);background:#184029}
.cell.used{background:var(--grid-used);color:#6e8a78;border-style:dashed;cursor:not-allowed}
.cell.selected{outline:2px solid var(--accent);box-shadow:0 0 0 2px rgba(53,196,110,.25) inset}

.log{max-height:480px;overflow:auto;font-family:ui-monospace,Consolas,monospace;font-size:12px;line-height:1.5}
.log b{color:var(--good)}.listbox{max-height:240px;overflow:auto;background:#0f2016;border:1px solid var(--border);border-radius:10px;padding:8px}
.qbar button{padding:6px 8px;font-size:12px}.qbar .chosen{outline:2px solid var(--accent)}
.qline{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:6px}
.hint{font-size:12px;color:#cfe9d5}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--border);background:#0f2016;font-size:11px;color:#cfe9d5}
</style>
</head>
<body>
<header><h1>Hundred PvP v3.3.2</h1></header>
<main>
  <section class="card">
    <h2>セットアップ</h2>
    <div class="row">
      <button id="btnNew" class="accent">新しい対局</button>
    </div>
    <div id="status" class="muted">対局を開始してください。</div>
    <div class="sep"></div>
    <h2>ターン</h2>
    <div>ターン：<span id="turnNow">-</span>　先攻：<span id="turnStarter">-</span>　後攻：<span id="asker">-</span></div>
    <div class="row" style="margin-top:8px;gap:12px">
      <span class="badge" id="badgeP1">P1: 未確定</span>
      <span class="badge" id="badgeP2">P2: 未確定</span>
    </div>
    <div class="row" style="margin-top:8px;gap:8px">
      <button id="btnLock" class="accent" disabled>先攻決定</button>
      <button id="btnReveal" class="accent" disabled>後攻決定</button>
    </div>
    <div class="sep"></div>
    <h2>後攻のライフナイン</h2>
    <div class="row qbar">
      <button class="qbtn" data-q="one" disabled>ワン</button>
      <button class="qbtn" data-q="two" disabled>ツー</button>
      <button class="qbtn" data-q="three" disabled>スリー</button>
      <button class="qbtn" data-q="four" disabled>フォー</button>
      <button class="qbtn" data-q="five" disabled>ファイブ</button>
      <button class="qbtn" data-q="six" disabled>シックス</button>
      <button class="qbtn" data-q="seven" disabled>セブン</button>
      <button class="qbtn" data-q="eight" disabled>エイト</button>
      <button class="qbtn" data-q="nine" disabled>ナイン</button>
    </div>
    <div class="qline"><input id="setInput" placeholder="シックス用: 最大6つの数字" disabled/></div>
  </section>

  <section class="card"><h2>P1の未使用数字</h2><div id="gridP1" class="grid"></div></section>
  <section class="card"><h2>P2の未使用数字</h2><div id="gridP2" class="grid"></div><div class="sep"></div><h2>ログ</h2><div id="log" class="log"></div></section>
</main>

<script>
const state={
  turn:0,turnStarter:"p1",
  availableP1:new Set(),availableP2:new Set(),
  selP1:null,baseP1:null,selP2:null,baseP2:null,
  qKey:null,qLocked:false,qSetN:[],revealed:false
};
const $=s=>document.querySelector(s);
const logEl=$("#log");

function followerSide(){return (state.turnStarter==="p1")?"p2":"p1";}
function log(msg){const d=document.createElement("div");d.innerHTML=msg;logEl.appendChild(d);logEl.scrollTop=logEl.scrollHeight;}

function renderGrid(which){
  const el=$("#grid"+which.toUpperCase());el.innerHTML="";
  const avail=which==="p1"?state.availableP1:state.availableP2;
  const sel=which==="p1"?state.selP1:state.selP2;
  for(let n=100;n>=1;--n){
    const cell=document.createElement("div");cell.className="cell";cell.textContent=n;
    if(!avail.has(n))cell.classList.add("used");
    else{
      cell.addEventListener("click",()=>{
        if(state.revealed)return;
        if(which==="p1"){state.selP1=(state.selP1===n?null:n);}
        else{state.selP2=(state.selP2===n?null:n);}
        renderGrid("p1");renderGrid("p2");updateBadges();updateControls();
      });
      if(sel===n)cell.classList.add("selected");
    }
    el.appendChild(cell);
  }
}

function updateBadges(){
  $("#badgeP1").textContent="P1:"+(state.baseP1??state.selP1??"未確定");
  $("#badgeP2").textContent="P2:"+(state.baseP2??state.selP2??"未確定");
}

function updateControls(){
  // 先攻決定
  const canLockStarter=(!state.revealed)&&(
    (state.turnStarter==="p1"&&state.selP1!=null&&state.baseP1==null)||
    (state.turnStarter==="p2"&&state.selP2!=null&&state.baseP2==null));
  $("#btnLock").disabled=!canLockStarter;

  // 後攻決定
  const f=followerSide();
  const fHasPick=(f==="p1")?(state.baseP1!=null||state.selP1!=null):(state.baseP2!=null||state.selP2!=null);
  const canReveal=!state.revealed&&(state.qKey!=null&&state.qLocked)&&fHasPick;
  $("#btnReveal").disabled=!canReveal;

  document.querySelectorAll(".qbtn").forEach(b=>b.disabled=!(f==="p1"||f==="p2")||state.revealed||state.qLocked);
}

function resetGame(){
  state.turn=0;state.turnStarter="p1";
  state.availableP1=new Set(Array.from({length:100},(_,i)=>i+1));
  state.availableP2=new Set(Array.from({length:100},(_,i)=>i+1));
  state.selP1=state.baseP1=state.selP2=state.baseP2=null;
  state.qKey=null;state.qLocked=false;state.qSetN=[];state.revealed=false;
  $("#turnNow").textContent="0";$("#turnStarter").textContent="P1";$("#asker").textContent="P2";
  logEl.innerHTML="";renderGrid("p1");renderGrid("p2");updateBadges();updateControls();
}

function lockStarterIfReady(){
  if(state.turnStarter==="p1"&&state.baseP1==null&&state.selP1!=null)state.baseP1=state.selP1;
  if(state.turnStarter==="p2"&&state.baseP2==null&&state.selP2!=null)state.baseP2=state.selP2;
}

function revealAndJudge(){
  if(state.revealed)return;
  lockStarterIfReady();
  const f=followerSide();
  if(f==="p1"&&state.baseP1==null&&state.selP1!=null)state.baseP1=state.selP1;
  if(f==="p2"&&state.baseP2==null&&state.selP2!=null)state.baseP2=state.selP2;
  if(!(state.qKey&&state.qLocked)){alert("後攻のライフナインを選んでください。");return;}
  if(state.baseP1==null||state.baseP2==null){alert("両者の数字を選んでください。");return;}
  log(`<b>[公開]</b> P1=${state.baseP1} / P2=${state.baseP2}`);
  state.revealed=true;
}

$("#btnNew").addEventListener("click",resetGame);
$("#btnLock").addEventListener("click",()=>{lockStarterIfReady();updateBadges();updateControls();});
$("#btnReveal").addEventListener("click",revealAndJudge);
document.querySelectorAll(".qbtn").forEach(b=>{
  b.addEventListener("click",()=>{
    state.qKey=b.dataset.q;state.qLocked=true;log(`後攻ライフナイン:${b.textContent}`);updateControls();
  });
});

resetGame();
</script>
</body>
</html>
